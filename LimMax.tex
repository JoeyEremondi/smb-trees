

\subsection{Limit-based Maximum}
\label{subsec:limmax}

Since the limit constructor finds the least upper bound
of the image of a function, it should be possible to define
the maximum of two trees as a special case of general limits.
Indeed, we can compute the maximum of $t_1$ and $t_2$ as the limit
of the function that produces $t_1$ when given $0$ and $t_2$ otherwise.

\begin{code}[hide]%
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}≤\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}<\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Binary.PropositionalEquality}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Nullary}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Iso}\<%
\\
%
\>[2]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{LimMax}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ℓ}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaBound{ℂ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaBound{ℓ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{El}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaBound{ℓ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{Cℕ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Iso}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{Cℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\>[4]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Brouwer}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{Cℕ}\AgdaSpace{}%
\AgdaBound{CℕIso}\<%
\end{code}

\begin{code}%
%
\>[4]\AgdaFunction{limMax}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Tree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPostulate{Tree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPostulate{Tree}\<%
\\
%
\>[4]\AgdaFunction{limMax}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaPostulate{ℕLim}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\<%
\end{code}

This version of the maximum has several of the properties we want from a
maximum function: it is monotone, idempotent,
commutative, and is a true least-upper-bound of its inputs.

\begin{code}%
%
\>[4]\AgdaFunction{limMax≤L}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaFunction{limMax}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
%
\>[4]\AgdaFunction{limMax≤L}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{=}%
\>[69I]\AgdaPostulate{≤-cocone}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.inv}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[69I]%
\>[10]\AgdaSymbol{(}\AgdaFunction{subst}\<%
\\
\>[10][@{}l@{\AgdaIndent{0}}]%
\>[12]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\<%
\\
%
\>[12]\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.rightInv}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\<%
\\
%
\>[12]\AgdaSymbol{(}\AgdaPostulate{≤-refl}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{limMax≤R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaFunction{limMax}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
%
\>[4]\AgdaComment{--\ Symmetric}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{limMaxIdem}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{limMax}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[4]\AgdaFunction{limMaxIdem}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaPostulate{≤-limiting}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaFunction{helper}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaKeyword{where}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaFunction{helper}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[8]\AgdaFunction{helper}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{k}\<%
\\
%
\>[8]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaPostulate{≤-refl}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[8]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaPostulate{≤-refl}\AgdaSpace{}%
\AgdaBound{t}\<%
\end{code}

      \je{TODO update description}
      From these properties, we can compute several other useful properties:
      monotonicity, commutativity, and that it is in fact the least of all upper bounds.

      \begin{code}%
%
\>[4]\AgdaFunction{limMaxMono}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{\}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaBound{t2'}\<%
\\
%
\>[8]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{limMax}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaFunction{limMax}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{limMaxCommut}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{limMax}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaFunction{limMax}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t1}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{limMaxLUB}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{limMax}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\end{code}
  It is not surprising that this version of the maximum is a least upper bound:
  by definition $\Lim$ computes the least upper bound of a function's image,
  and $\limMax$ is simply $\Lim$ applied to a function whose image has (at most) two elements.

\begin{code}[hide]%
\>[0]\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{limMax≤R}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{=}%
\>[191I]\AgdaPostulate{≤-cocone}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.inv}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[191I]%
\>[10]\AgdaSymbol{(}\AgdaFunction{subst}\<%
\\
\>[10][@{}l@{\AgdaIndent{0}}]%
\>[12]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\<%
\\
%
\>[12]\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.rightInv}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSymbol{))}\<%
\\
%
\>[12]\AgdaSymbol{(}\AgdaPostulate{≤-refl}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{limMaxMono}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaPostulate{extLim}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaFunction{helper}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaKeyword{where}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaFunction{helper}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[8][@{}l@{\AgdaIndent{0}}]%
\>[10]\AgdaFunction{if0}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
\>[10][@{}l@{\AgdaIndent{0}}]%
\>[12]\AgdaOperator{\AgdaPostulate{≤}}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\<%
\\
%
\>[8]\AgdaFunction{helper}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{k}\<%
\\
%
\>[8]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{lt1}\<%
\\
%
\>[8]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{lt2}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{limMaxLUB}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{limMaxMono}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{≤⨟}}\AgdaSpace{}%
\AgdaFunction{limMaxIdem}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{limMaxCommut}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{limMaxLUB}\AgdaSpace{}%
\AgdaFunction{limMax≤R}\AgdaSpace{}%
\AgdaFunction{limMax≤L}\<%
\end{code}

  \subsubsection{Limitation: Strict Monotonicity}

The one crucial property that this formulation lacks is that it is not
strictly monotone: we cannot deduce $\max\ t_1\ t_1 < \max\ t'_1 \ t'_2 $
from $t_1 < t'_1$ and $t_2 < t'_2$. This is because the only way to construct a
proof that $\up t \le \Lim\ c\ f$
is using the $\cocone$ constructor. So we would need to prove that
$\up (\max\ t_{1} \ t_{2}) \le t'_{1}$ or that
$\up (\max\ t_{1} \ t_{2}) \le t'_{2}$, which cannot be deduced from the
premises alone.
%
What we want is to have $\up \max\ (t_{1}) \ t_{2} \le \max (\up t_{1})\ (\up t_{2})$, so that strict monotonicity is a direct consequence of ordinary
monotonicity of the maximum. This is not possible when defining the constructor as a limit.
