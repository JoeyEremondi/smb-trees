% !TEX root =  main.tex

\subsection{Strictly Monotone Brouwer Trees}
\label{subsec:smb}

Now that we have identified a substantial class of well-behaved Brouwer trees,
we want to define a new type containing only those trees.
In this section, we will define strictly monotone Brouwer trees (SMB-trees), and show how
they can be given a similar interface to Brouwer trees.

\begin{code}[hide]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}≤\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}<\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Binary.PropositionalEquality}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Maybe}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Nullary}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Iso}\<%
\end{code}

To begin, we declare a new Agda module, with the same parameters
we have been working with thus far: a type of codes, interpretations of those codes into types,
and a code whose interpretation is isomorphic to $\bN$.
\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{SMBTree}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ℓ}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaBound{ℂ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaBound{ℓ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{El}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaBound{ℓ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{Cℕ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Iso}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{Cℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}

Next we import all of our definitions so far, using the ``Brouwer'' prefix to distinguish
them from the trees and ordering we are about to define.
Critically, we do not instantiate these with the same interpretation function.
Instead, we interpret each code wrapped in $\AgdaDatatype{Maybe}$.
Note that if a type $T$ is isomorphic to $\bN$, then $\AgdaDatatype{Maybe}\ T$ is as well.
Wrapping in $\AgdaDatatype{Maybe}$ ensures that we always take Brouwer limits over non-empty sets,
an assumption that was critical for the definitions of \cref{subsec:indmax}.
Essentially, we are adding an explicit zero to every sequence whose limit we take,
so that the sequences are never empty, but the upper bound does not change.
This detail is hidden in the interface for SMB-trees: the assumption of non-emptiness
is only used in the Brouwer trees underlying SMB-trees.
\begin{code}%
\>[0]\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Brouwer}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaBound{ℂ}\<%
\\
%
\>[4]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Maybe}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{))}\<%
\\
%
\>[4]\AgdaBound{Cℕ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{maybeNatIso}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSymbol{)}
\ \ as\ \AgdaModule{Brouwer}\<%
\end{code}


\begin{code}[hide]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{IndMax}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Maybe}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{Cℕ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{maybeNatIso}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{InfinityMax}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Maybe}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{Cℕ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{maybeNatIso}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{infixr}\AgdaSpace{}%
\AgdaNumber{10}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}≤⨟\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infixr}\AgdaSpace{}%
\AgdaNumber{10}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}≤\AgdaUnderscore{}}}\<%
\end{code}


\subsubsection{Refining Brouwer Trees}

We define SMB-trees as a dependent record,
containing an underlying Brouwer tree, and a proof
that $\indMax$ is idempotent on this tree.

\begin{code}%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaBound{ℓ}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{MkTree}\<%
\\
%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{rawTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Brouwer.Tree}\<%
\\
%
\>[4]\AgdaField{isIdem}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{indMax}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Brouwer.≤}}\AgdaSpace{}%
\AgdaField{rawTree}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SMBTree}\<%
\end{code}
%

We can then define so-called ``smart-constructors'' corresponding to each of the constructors
for Brouwer-trees: zero, successor, and limit.
Zero and successor directly correspond to the Brouwer tree zero and successor.
Their proofs of idempotence are trivial from the properties of Brouwer $\le$.
\begin{code}%
\>[0]\AgdaKeyword{opaque}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{unfolding}\AgdaSpace{}%
\AgdaFunction{indMax}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{Z}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{SMBTree}\<%
\\
%
\>[2]\AgdaFunction{Z}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{MkTree}\AgdaSpace{}%
\AgdaInductiveConstructor{Brouwer.Z}\AgdaSpace{}%
\AgdaInductiveConstructor{Brouwer.≤-Z}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{↑}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\<%
\\
%
\>[2]\AgdaFunction{↑}%
\>[106I]\AgdaSymbol{(}\AgdaInductiveConstructor{MkTree}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{pf}\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[106I]%
\>[4]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{MkTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Brouwer.↑}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Brouwer.≤-sucMono}\AgdaSpace{}%
\AgdaBound{pf}\AgdaSymbol{)}\<%
\end{code}

However, constructing the limit of a sequence of SMB-trees is not so easy.
Since we instantiated $\AgdaBound{El}$ to wrap its result in $\AgdaDatatype{Maybe}$,
we need to handle $\AgdaInductiveConstructor{nothing}$ for each limit,
but we can use $\AgdaFunction{Z}$ as a default value, since adding it to any sequence
does not change the least upper bound.
More challenging is how, as we saw in \cref{subsec:indmax}, Brouwer trees do not have $\indMax\ (\Lim\ c\ f)\ (\Lim\ c\ f) \le \Lim\ c\ f$, so we cannot directly produce a proof of idempotence.

Our key insight is to define limits of SMB-trees using $\maxInf$ on the underlying trees:
for any function producing SMB-trees, we take the limit of the underlying trees,
then $\indMax$ that result with itself an infinite number of times.
The idempotence proof is then the property of $\maxInf$ that we proved in \cref{subsec:infinity}.
\begin{code}%
%
\>[2]\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}%
\>[12]\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\<%
\\
%
\>[2]\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{MkTree}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaFunction{indMax∞}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{(}\AgdaInductiveConstructor{Brouwer.Lim}\AgdaSpace{}%
\AgdaBound{c}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{(}\AgdaFunction{maybe′}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{Brouwer.Z}\AgdaSymbol{)))}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaFunction{indMax∞-idem}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\<%
\end{code}



\subsubsection{Ordering SMB-trees}

SMB-trees are ordered by the order on their underlying Brouwer trees:
%
\begin{code}%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}≤\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaBound{ℓ}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}\<%
\\
%
\>[2]\AgdaKeyword{inductive}\<%
\\
%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{get≤}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Brouwer.≤}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaOperator{\AgdaModule{\AgdaUnderscore{}≤\AgdaUnderscore{}}}\<%
\\
\>[0]\<%
\end{code}
%
The successor function allows us to define a strict order on SMB-trees.
\begin{code}%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}<\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaBound{ℓ}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}<\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{↑}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t2}\<%
\end{code}

The next step is to prove that our SMB-tree constructors satisfy the same
inequalities as Brouwer trees. Since SMB-trees are ordered by their underlying
Brouwer trees, most properties can be directly lifted from  Brouwer trees
to SMB-trees.

\begin{code}%
\>[0]\AgdaKeyword{opaque}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{unfolding}\AgdaSpace{}%
\AgdaFunction{Z}\AgdaSpace{}%
\AgdaFunction{↑}\<%
\\
%
\>[2]\AgdaFunction{≤↑}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{↑}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[2]\AgdaFunction{≤↑}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[10]\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Brouwer.≤↑t}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}≤⨟\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t3}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t3}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t3}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}≤⨟\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Brouwer.≤-trans}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{≤-refl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[2]\AgdaFunction{≤-refl}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[12]\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Brouwer.≤-refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\<%
\end{code}

The constructors for $\le$ each have a counterpart for SMB-trees.
For zero and successor, these are trivially lifted.
\begin{code}%
%
\>[2]\AgdaFunction{≤-Z}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Z}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[2]\AgdaFunction{≤-Z}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[9]\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaInductiveConstructor{Brouwer.≤-Z}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{≤-sucMono}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{↑}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{↑}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
%
\>[2]\AgdaFunction{≤-sucMono}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Brouwer.≤-sucMono}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSymbol{)}\<%
\end{code}
  The constructors for ordering limits require more attention.
  To show that an SMB-tree limit is an upper bound, we use the fact
  that the underlying limit was an upper bound, and the fact that $\maxInf$ is as large as its argument,
  since the SMB-tree $\AgdaFunction{Lim}$ wraps its result in $\maxInf$.
  Note that, since we already have transitivity for our new $\le$,
  we can simply show that $f\ k$ is less than the limit of $f$,
  avoiding the more complicated form of $\cocone$.
\begin{code}%
%
\>[2]\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}%
\>[24]\AgdaSymbol{\{}\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{f}\<%
\\
%
\>[2]\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{k}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}%
\>[277I]\AgdaSymbol{(}\AgdaInductiveConstructor{Brouwer.≤-cocone}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Brouwer.≤-refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\<%
\\
\>[277I][@{}l@{\AgdaIndent{0}}]%
\>[11]\AgdaOperator{\AgdaFunction{Brouwer.≤⨟}}\AgdaSpace{}%
\AgdaFunction{indMax∞-self}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Brouwer.Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}))}\<%
\end{code}

Finally, we need to show that the SMB-tree limit is less than all other upper bounds.
Suppose $t : \AgdaDatatype{SMBTree}$ is an upper bound for $f$,
and $t_u$ is the underlying tree for $t$, and $f_u$ computes the underlying trees for $f$.
Then $\limiting$ gives that the underlying tree for $t$ is an upper bound for the trees underlying the image of $f$.
However, the SMB-tree limit wraps its result in $\maxInf$, so we need to show that $\maxInf$ of the limit
is also less than $t'$.
The monotonicity of $\maxInf$ then gives that $\indMax (\Lim\ c\ f_u)$ is less than $\maxInf\ t'$.
In \cref{subsec:infinity}, we showed that $\maxInf$ had no effect on Brouwer trees that $\indMax$ was idempotent on.
This is exactly what the  $\AgdaField{isIdem}$ field of SMB-trees contains! So we have $\maxInf\ t' \le\ t'$,
and transitivity gives our result.
\begin{code}%
%
\>[2]\AgdaFunction{≤-limLeast}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}%
\>[19]\AgdaSymbol{\{}\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(∀}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[2]\AgdaFunction{≤-limLeast}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{MkTree}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{idem}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{lt}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{=}%
\>[323I]\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\<%
\\
\>[.][@{}l@{}]\<[323I]%
\>[6]\AgdaFunction{indMax∞-mono}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{(}\AgdaInductiveConstructor{Brouwer.≤-limiting}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[8][@{}l@{\AgdaIndent{0}}]%
\>[10]\AgdaSymbol{(}\AgdaFunction{maybe}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{get≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{lt}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{Brouwer.≤-Z}\AgdaSymbol{))}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{Brouwer.≤⨟}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{indMax∞-≤}\AgdaSpace{}%
\AgdaBound{idem}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}


\subsubsection{The Join for SMB-trees}
Our whole reason for defining SMB-trees was to define a well-behaved maximum operator,
and we finally have the tools to do so.
We can define the join in terms of $\indMax$ on the underlying trees.
The proof that the $\indMax$ is idempotent on the result follows from
associativity, commutativity, and monotonicity of $\indMax$.
\begin{code}%
\>[0]\AgdaKeyword{opaque}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{unfolding}\AgdaSpace{}%
\AgdaFunction{indMax}\AgdaSpace{}%
\AgdaFunction{Z}\AgdaSpace{}%
\AgdaFunction{↑}\AgdaSpace{}%
\AgdaFunction{indMaxView}\<%
\\
%
\>[2]\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\<%
\\
%
\>[2]\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{MkTree}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{(}\AgdaFunction{indMax}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{))}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaFunction{indMax-swap4}%
\>[353I]\AgdaSymbol{\{}\AgdaArgument{t1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[353I]%
\>[20]\AgdaSymbol{\{}\AgdaArgument{t2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaOperator{\AgdaFunction{Brouwer.≤⨟}}\AgdaSpace{}%
\AgdaFunction{indMax-mono}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isIdem}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isIdem}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{))}\<%
\end{code}

For Brouwer trees, $\indMax$ had all the properties we wanted
except for idempotence. All of these can be lifted directly to
SMB-trees:

\begin{code}%
%
\>[2]\AgdaFunction{max-≤L}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-≤R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-mono}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-idem≤}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-commut}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t1}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-assocL}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t3}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t3}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{t3}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-assocR}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t3}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[7]\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{t3}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t3}\AgdaSymbol{)}\<%
\end{code}

In particular, $\AgdaFunction{max}$ is strictly monotone, and distributes over
the successor:

\begin{code}%
%
\>[2]\AgdaFunction{max-strictMono}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-sucMono}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{↑}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{↑}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{)}\<%
\end{code}

However, because we restricted SMB-trees to only contain Brouwer trees that
$\indMax$ is idempotent on, we can prove that $\AgdaFunction{Max}$ is
idempotent for SMB-trees:

\begin{code}%
%
\>[2]\AgdaFunction{max-idem}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[2]\AgdaFunction{max-idem}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{MkTree}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{pf}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaBound{pf}\<%
\end{code}

\begin{code}[hide]%
\>[0]\<%
\\
%
\>[2]\AgdaFunction{≤-extLim}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}%
\>[16]\AgdaSymbol{\{}\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f1}\AgdaSpace{}%
\AgdaBound{f2}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(∀}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{f1}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{f2}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{f1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{f2}\<%
\\
%
\>[2]\AgdaFunction{≤-extLim}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{f1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{f2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤-limLeast}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≤⨟}}\AgdaSpace{}%
\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{f2}\AgdaSpace{}%
\AgdaBound{v}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{≤-extExists}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}%
\>[19]\AgdaSymbol{\{}\AgdaBound{c1}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ℂ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f2}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(∀}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Σ[}\AgdaSpace{}%
\AgdaBound{k2}\AgdaSpace{}%
\AgdaFunction{∈}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{f1}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{f2}\AgdaSpace{}%
\AgdaBound{k2}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaBound{f1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaBound{f2}\<%
\\
%
\>[2]\AgdaFunction{≤-extExists}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{f1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤-limLeast}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{lt}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≤⨟}}\AgdaSpace{}%
\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{lt}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSymbol{)))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{¬Z<↑}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}%
\>[12]\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaFunction{↑}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{Z}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{¬Z<↑}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{pf}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Brouwer.¬<Z}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{get≤}\AgdaSpace{}%
\AgdaBound{pf}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-≤L}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaFunction{indMax-≤L}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-≤R}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[32]\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{indMax-≤R}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-mono}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{indMax-mono}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{get≤}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{get≤}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-monoR}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2'}\<%
\\
%
\>[2]\AgdaFunction{max-monoR}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{max-mono}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-refl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaBound{lt}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-monoL}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
%
\>[2]\AgdaFunction{max-monoL}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{max-mono}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-refl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\})}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-idem≤}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{MkTree}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{pf}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{max-≤L}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-commut}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[22]\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{indMax-commut}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-assocL}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t3}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{indMax-assocL}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t3}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-assocR}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t3}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{indMax-assocR}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t3}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-swap4}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{max-swap4}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[59]\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{indMax-swap4}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{\})}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-strictMono}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{indMax-strictMono}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{get≤}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{get≤}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{max-sucMono}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSymbol{\}}%
\>[47]\AgdaSymbol{\{}\AgdaArgument{t2'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[65]\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{indMax-sucMono}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t1'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{t2'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{get≤}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSymbol{))}\<%
\\
\>[0]\<%
\end{code}

These together are enough to prove that our maximum is
the least of all upper bounds.
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[2]\AgdaFunction{max-LUB}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[2]\AgdaFunction{max-LUB}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{max-mono}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≤⨟}}\AgdaSpace{}%
\AgdaFunction{max-idem}\<%
\end{code}

  Perhaps surprisingly, this means that an SMB-tree version of $\limMax$
  is equivalent to $\AgdaFunction{max}$, since they are both the least upper bound.
  This in turn means that the limit based maximum is strictly monotone for SMB-trees.
  \begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{ℕLim}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\<%
\\
\>[0]\AgdaFunction{ℕLim}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{Cℕ}%
\>[17]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{cn}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{cn}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\<%
\\
\>[0]\AgdaFunction{max'}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ℕLim}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max'-≤L}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max'}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max'-≤R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max'}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max'-LUB}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max'}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max≤max'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max'}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
\>[0]\AgdaFunction{max≤max'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{max-LUB}\AgdaSpace{}%
\AgdaFunction{max'-≤L}\AgdaSpace{}%
\AgdaFunction{max'-≤R}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max'≤max}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max'}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
\>[0]\AgdaFunction{max'≤max}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{max'-LUB}\AgdaSpace{}%
\AgdaFunction{max-≤L}\AgdaSpace{}%
\AgdaFunction{max-≤R}\<%
\end{code}


\begin{code}[hide]%
\>[0]\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max'-≤L}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{=}%
\>[1018I]\AgdaFunction{subst}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.rightInv}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaFunction{≤-refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≤⨟}}\<%
\\
\>[.][@{}l@{}]\<[1018I]%
\>[6]\AgdaFunction{≤-limUpperBound}%
\>[23]\AgdaSymbol{(}\AgdaField{Iso.inv}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max'-≤R}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{=}%
\>[1038I]\AgdaFunction{subst}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.rightInv}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaFunction{≤-refl}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≤⨟}}\<%
\\
\>[.][@{}l@{}]\<[1038I]%
\>[6]\AgdaFunction{≤-limUpperBound}%
\>[23]\AgdaSymbol{(}\AgdaField{Iso.inv}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max'-Idem}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max'}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
\>[0]\AgdaFunction{max'-Idem}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤-limLeast}%
\>[28]\AgdaFunction{helper}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaKeyword{where}\<%
\\
%
\>[4]\AgdaFunction{helper}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[4]\AgdaFunction{helper}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{k}\<%
\\
%
\>[4]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤-refl}\<%
\\
%
\>[4]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤-refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max'-Mono}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t2'}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max'}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max'}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\<%
\\
\>[0]\AgdaFunction{max'-Mono}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t2'}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤-extLim}%
\>[52]\AgdaFunction{helper}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaKeyword{where}\<%
\\
%
\>[4]\AgdaFunction{helper}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{if0}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{t1'}\AgdaSpace{}%
\AgdaBound{t2'}\<%
\\
%
\>[4]\AgdaFunction{helper}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaField{Iso.fun}\AgdaSpace{}%
\AgdaBound{CℕIso}\AgdaSpace{}%
\AgdaBound{k}\<%
\\
%
\>[4]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{lt1}\<%
\\
%
\>[4]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{lt2}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max'-LUB}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{max'-Mono}\AgdaSpace{}%
\AgdaBound{lt1}\AgdaSpace{}%
\AgdaBound{lt2}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≤⨟}}\AgdaSpace{}%
\AgdaFunction{max'-Idem}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{limSwap}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c1}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
\>[0]\AgdaFunction{limSwap}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤-limLeast}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{≤-limLeast}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≤⨟}}\AgdaSpace{}%
\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaBound{y}%
\>[86]\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max-swapL}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}%
\>[44]\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{max-swapL}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{g}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤-limLeast}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max-mono}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max-swap2L}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c1}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}%
\>[71]\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c2}%
\>[94]\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{k2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{k2}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{max-swap2L}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c1}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{g}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤-limLeast}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{≤-limLeast}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{k2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max-mono}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaBound{k2}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max-swapR}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{max-swapR}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{g}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{max-LUB}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-extLim}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max-≤L}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-extLim}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max-≤R}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{max-swap2R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c1}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{SMBTree}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{El}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c2}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c1}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lim}\AgdaSpace{}%
\AgdaBound{c2}%
\>[137]\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{k2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{k2}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{max-swap2R}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSpace{}%
\AgdaBound{k2}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{max-LUB}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaFunction{≤-extLim}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaBound{k2}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≤⨟}}\AgdaSpace{}%
\AgdaFunction{≤-extLim}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max-≤L}\AgdaSymbol{))}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaFunction{≤-limUpperBound}\AgdaSpace{}%
\AgdaBound{k1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≤⨟}}\AgdaSpace{}%
\AgdaFunction{≤-extLim}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{≤-extLim}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{max-≤R}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Induction.WellFounded}\<%
\\
\>[0]\AgdaKeyword{opaque}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{unfolding}\AgdaSpace{}%
\AgdaFunction{↑}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{invertSuc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t1}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{↑}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaFunction{↑}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{≤}}\AgdaSpace{}%
\AgdaBound{t2}\<%
\\
%
\>[2]\AgdaFunction{invertSuc}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{MkTree}\AgdaSpace{}%
\AgdaBound{t1}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{MkTree}\AgdaSpace{}%
\AgdaBound{t2}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Brouwer.\AgdaUnderscore{}≤\AgdaUnderscore{}.≤-sucMono}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mk≤}\AgdaSpace{}%
\AgdaBound{lt}\<%
\end{code}


\subsubsection{Well-founded Ordering on SMB-trees}
Our motivation for defining SMB-trees was defining well-founded recursion,
so the final piece of our definition is a proof that the strict ordering of
SMB-trees is well-founded.
Intuitively this should hold: there are no infinite descending chains
of Brouwer trees, and there are fewer SMB-trees than Brouwer trees, so
there can be no infinite descending chains of SMB-trees.
The key lemma is that an SMB-tree is accessible if its underlying Brouwer tree is.
\begin{code}%
%
\>[2]\AgdaFunction{sizeWF}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{WellFounded}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}<\AgdaUnderscore{}}}\<%
\\
%
\>[2]\AgdaFunction{sizeWF}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sizeAcc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Brouwer.ordWF}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaKeyword{where}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaFunction{sizeAcc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSymbol{\}}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Acc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Brouwer.\AgdaUnderscore{}<\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\<%
\\
%
\>[8]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Acc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}<\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[6]\AgdaFunction{sizeAcc}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{acc}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{acc}\AgdaSpace{}%
\AgdaSymbol{((λ}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{sizeAcc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{rawTree}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{get≤}\AgdaSpace{}%
\AgdaBound{lt}\AgdaSymbol{))))}\<%
\end{code}

Thus, we have an ordinal type with limits, a strictly monotone join,
and well-founded recursion.
